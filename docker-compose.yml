services:
  database:
    image: mongo
    restart: always
    volumes:
      - law-dev-database:/data/db
  frontend:
    image: lawassist/frontend:dev-latest
    volumes:
      - .:/workspace:cached
      - frontend-dev-node-module:/workspace/FE/node_modules
    environment:
      - NEXT_PUBLIC_API_HOST=http://localhost:29003
      - NEXTAUTH_URL=http://localhost:29002/
    command: sleep infinity
    network_mode: service:backend
  backend:
    image: lawassist/backend:dev-latest
    volumes:
      - .:/workspace:cached
      - backend-dev-node-module:/workspace/BE/node_modules
    environment:
      - MONGODB_URI=mongodb://localhost:27017/law_linking
    command: sleep infinity
    network_mode: service:database
  ai-law-linking:
    image: lawassist/ai-law-linking:dev-latest
    volumes:
      - .:/workspace:cached
    environment:
      - DATABASE_URI=mongodb://localhost:27017/law_linking
    command: sleep infinity
    network_mode: service:database
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all # alternatively, use `count: all` for all GPUs
              capabilities: [gpu]
volumes:
  law-dev-database:
  frontend-dev-node-module:
  backend-dev-node-module: